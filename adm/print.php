<?phpob_start();session_start();require('../_app/Config.inc.php');$Adm = [3, 4];$login = new Login($Adm);if (!$login->CheckLogin()):    unset($_SESSION['userlogin']);    header('Location: index.php?exe=restrito');    exit;endif;?><!DOCTYPE html><html>    <head>        <meta charset="UTF-8">        <title>Relatórios</title>        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>        <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700" rel="stylesheet"/>        <link rel="stylesheet" href="css/linearicons/web-font.css"/>                <link rel="stylesheet" href="css/style_print.css"/>        <link rel="stylesheet" href="css/normalize_print.css"/>        <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.js"></script>        <script type="text/javascript">            window.print();        </script>        <style>            .table_print{                /*font-size: 0.7em;*/            }            .table_print td, .table_print th{                padding: 0.9em 0.9em;            }        </style>    </head>    <body>        <?php        $Id = filter_input(INPUT_GET, 'relatorio', FILTER_DEFAULT);        if (isset($Id)) {            $Read = new Read;            $Read->FullRead("SELECT * FROM tb_relatorios INNER JOIN tb_empresas ON IdEmpresa = IdEmpresaRelatorio WHERE IdRelatorio = :id", "id={$Id}");            extract($Read->getResult()[0]);            ?>        <center>            <table border="1" class='table table-bordered'>                <thead>                    <tr>                        <th colspan="2"><img src="./images/logo_peq.png"></th>                        <th colspan="2"><center>Relatório Atividades</center></th>                <th colspan="2">Data: <?php echo date('d/m/Y', strtotime($DataRelatorio)); ?></th>                </tr>                </thead>                <tbody>                    <tr>                        <th colspan="6"><center>Dados do cliente /Consultor</center></th>                </tr>                <tr>                    <th colspan="1">Empresa:</th><td colspan="3"><?php echo $NomeEmpresa; ?></td>                    <th colspan="1">Projeto:</th><td><?php echo $ProjetoRelatorio; ?></td>                </tr>                <tr>                    <th colspan="1">Consultor</th><td colspan="3"><?php echo $ConsultorRelatorio; ?></td>                    <th colspan="1">Codigo:</th><td><?php echo $CodigoRelatorio; ?></td>                </tr>                <tr>                    <th colspan="6"><center>Serviços executados</center></th>                </tr>                <tr>                    <th>Fase</th>                    <th>TS(*)</th>                    <th>Descrição do serviço</th>                    <th>Hr. Inicio</th>                    <th>Hr. Fim</th>                    <th>Total Horas</th>                </tr>                <tr>                    <td><?php echo $FaseRelatorio; ?></td>                    <td><?php echo $TsRelatorio; ?></td>                    <td><?php echo $DescServicoRelatorio; ?></td>                    <td><?php echo date('H:i', strtotime($HInicioRelatorio)); ?></td>                    <td><?php echo date('H:i', strtotime($HFimRelatorio)); ?></td>                    <td><?php echo $HTotalRelatorio; ?></td>                </tr>                <tr>                    <th align="right" colspan="5">Total de horas trabalhadas:</th>                    <th><?php echo $HTotalRelatorio; ?></th>                </tr>                <?php                $Read->FullRead("SELECT * FROM tb_testemunhas WHERE IdRelatorio = :id", "id={$Id}");                if ($Read->getRowCount() >= 1) {                    echo '<th colspan="1"><center>Treinamento/Usuários</center></th>';                    echo '<th colspan="5"><center>Assinatura</center></th>';                    foreach ($Read->getResult() as $v):                        ?>                        <tr>                            <th colspan="1" align="left"><?php echo $v['NomeTes']; ?></th>                            <th colspan="5">&nbsp;</th>                        </tr>                        <?php                    endforeach;                }                ?>                <tr>                    <th colspan="1"><center>Modulos/Fase(s)</center></th>                <th colspan="5"><center>(*) Tipos de serviços</center></th>                </tr>                <tr>                    <td colspan="1"><?php echo $FasesModulosRelatorio; ?></td>                    <td colspan="5">                        <?php                        $Read->FullRead("SELECT * FROM tb_servicos");                        $col = 2;                        $numZ = $Read->getRowCount();                        $num2 = ceil($numZ / $col);                        $li = '<ul class="coluna">';                        $i = 0;                        foreach ($Read->getResult() as $LinhaZ) {                            if ($i == $num2) {                                $li .= '</ul><ul class="coluna">';                                $i = 0;                            }                            $li .= '<li>' . $LinhaZ['CodServico'] . ' - ' . $LinhaZ['NomeServico'] . '</li>';                            $i++;                        }                        $li .= '</ul>';                        echo $li;                        ?>                    </td>                </tr>                <tr>                    <th colspan="6"><center>Observações do cliente</center></th>                </tr>                <tr>                    <td colspan="6"><?php                        if (empty($ObsClienteRelatorio)) {                            echo "<br><br>";                        } else {                            echo $ObsClienteRelatorio;                        }                        ?></td>                </tr>                <tr>                    <th colspan="6"><center>Assinaturas</center></th>                </tr>                <tr>                    <td colspan="2">&nbsp;</td>                    <td colspan="2">&nbsp;</td>                    <td colspan="2">&nbsp;</td>                </tr>                <tr>                    <th colspan="2"><center>Cliente/Sponsor</center></th>                <th colspan="2"><center>Coordenador de projeto</center></th>                <th colspan="2"><center>Gerente de projeto</center></th></tr>                <tr>                    <th colspan="2"><center><?php echo $ClienteSponsorRelatorio; ?></center></th>                <th colspan="2"><center><?php echo $CoordProjetoRelatorio; ?></center></th>                <th colspan="2"><center><?php echo $GerenteProjetoRelatorio; ?></center></th>                </tr>                </tbody>            </table>        </center>        <?php    }    ?>    <?php    $post = filter_input_array(INPUT_POST, FILTER_DEFAULT);    $Get = filter_input(INPUT_GET, 'ticket', FILTER_DEFAULT);    $GetPort = filter_input(INPUT_GET, 'report', FILTER_DEFAULT);    if ($post && $Get === "true"):        $Read = new Read;        if ($post['IdEmpresaRelatorio'] == 'todos'):            $Read->FullRead(""                    . "SELECT *                            FROM tb_empresas                             JOIN tb_tickets ON idempresatickets = IdEmpresa                            WHERE data BETWEEN :ini AND :fim                            GROUP BY NomeEmpresa ORDER BY id, codigo", "ini={$post['HInicioRelatorio']}&fim={$post['HFimRelatorio']}");            ?>            <table border="1" style="width: 100%;" class="table_print">                 <thead>                <th colspan="2" rowspan="4">                    <img src="images/logo_med.png" width="180"/>                </th>                <th colspan="8" rowspan="4">                    Relatório de Chamados - HelpDesk <br/>                    Período de : <?= date('d/m/Y', strtotime($post['HInicioRelatorio'])); ?> a <?= date('d/m/Y', strtotime($post['HFimRelatorio'])); ?>  <br/>                    Seleção de Clientes : TODOS <br/>                </th>            </thead>            <?php            foreach ($Read->getResult() as $v):                extract($v);                ?>                <tr>                    <td colspan="2" rowspan="1">Razão Social :</td>                    <th colspan="8" rowspan="1"><?= $NomeEmpresa; ?></th>                </tr>                <tr>                    <th colspan="1">Nro Chamado</th>                    <th colspan="1">Usuário</th>                    <th colspan="3">Motivo do Chamado</th>                    <th colspan="1">Status</th>                    <th colspan="1">Data Chamado</th>                    <th colspan="1">Data Inicio</th>                    <th colspan="1">Data Final</th>                    <th colspan="1">Horas Aplicadas</th>                </tr>                <?php                $Read->FullRead("                                    SELECT *                                    FROM tb_tickets as a                                    INNER JOIN tb_usuarios as b ON b.IdUsuario = a.iduser                                    WHERE a.data BETWEEN :ini AND :fim AND a.idempresatickets =:id                                    ORDER BY a.data ASC", "ini={$post['HInicioRelatorio']}&fim={$post['HFimRelatorio']}&id={$IdEmpresa}");                $r = $Read->getRowCount();                foreach ($Read->getResult() as $x):                    ?>                    <tr>                        <td colspan="1"><?= $x['codigo']; ?></td>                        <td colspan="1"><?= $x['NomeUsuario']; ?></td>                        <td colspan="3"><?= $x['assunto']; ?></td>                        <td colspan="1"><?= $x['status']; ?></td>                        <td colspan="1"><?= date("d/m/Y", strtotime($x['data'])); ?></td>                        <td colspan="1"><?= date("H:i", strtotime($x['datainicio'])); ?></td>                        <td colspan="1"><?= date("H:i", strtotime($x['datafim'])); ?></td>                        <td colspan="1"><?= date("H:i", strtotime($x['horatotal'])); ?></td>                    </tr>                    <?php                endforeach;                ?>                <tr>                    <td colspan="10" rowspan="1"><br></td>                </tr>                <tr>                    <td colspan="4" rowspan="1"></td>                    <td colspan="6" rowspan="1">Total de atendimentos : <?= $r; ?></td>                </tr>                <tr>                    <td colspan="10" rowspan="1"><br></td>                </tr>                <?php            endforeach;            ?>        </table>        <?php    else:        $Read->FullRead("SELECT * FROM tb_empresas WHERE IdEmpresa = :id", "id={$post['IdEmpresaRelatorio']}");        ?>        <table border="1" style="width: 100%;" class="table_print">            <thead>            <th colspan="2" rowspan="4">                <img src="images/logo_med.png" width="180"/>            </th>            <th colspan="8" rowspan="4">                Relatório de Atendimento - HelpDesk <br/>                Período de : <?= date("d/m/Y", strtotime($post['HInicioRelatorio'])); ?> a <?= date("d/m/Y", strtotime($post['HFimRelatorio'])); ?>  <br/>                Seleção de Clientes : <?= $Read->getResult()[0]['NomeEmpresa']; ?> <br/>            </th>        </thead>        <?php        foreach ($Read->getResult() as $v):            extract($v);            ?>            <tr>                <td colspan="2" rowspan="1">Razão Social :</td>                <th colspan="8" rowspan="1"><?= $NomeEmpresa; ?></th>            </tr>            <tr>                <th colspan="1">Nro Chamado</th>                <th colspan="1">Usuário</th>                <th colspan="3">Motivo do Chamado</th>                <th colspan="1">Status</th>                <th colspan="1">Data Chamado</th>                <th colspan="1">Data Inicio</th>                <th colspan="1">Data Final</th>                <th colspan="1">Horas Aplicadas</th>            </tr>            <?php            $Read->FullRead("                            SELECT * FROM tb_tickets                             INNER JOIN tb_usuarios ON IdUsuario = iduser                            WHERE idempresatickets = :id AND datainicio BETWEEN :ini AND :fim                             ORDER BY datainicio ASC", "ini={$post['HInicioRelatorio']}&fim={$post['HFimRelatorio']}&id={$post['IdEmpresaRelatorio']}");            $r = $Read->getRowCount();            foreach ($Read->getResult() as $x):                ?>                <tr>                    <td colspan="1"><?= $x['codigo']; ?></td>                    <td colspan="1"><?= $x['NomeUsuario']; ?></td>                    <td colspan="3"><?= $x['assunto']; ?></td>                    <td colspan="1"><?= $x['status']; ?></td>                    <td colspan="1"><?= date("d/m/Y", strtotime($x['data'])); ?></td>                    <td colspan="1"><?= date("H:i", strtotime($x['datainicio'])); ?></td>                    <td colspan="1"><?= date("H:i", strtotime($x['datafim'])); ?></td>                    <td colspan="1"><?= date("H:i", strtotime($x['horatotal'])); ?></td>                </tr>                <?php            endforeach;            ?>            <tr>                <td colspan="10" rowspan="1"><br></td>            </tr>            <tr>                <td colspan="6" rowspan="1"></td>                <td colspan="4" rowspan="1">Total de atendimentos : <?= $r; ?></td>            </tr>            <tr>                <td colspan="10" rowspan="1"><br></td>            </tr>            <?php        endforeach;        ?>        </table>    <?php    endif;endif;?><?phpif ($post && $GetPort === "true"):    $Read = new Read;    if ($post['IdEmpresaRelatorio'] == 'todos'):        $Read->FullRead(""                . "SELECT *                            FROM tb_empresas                             JOIN tb_relatorios ON IdEmpresaRelatorio = IDEmpresa                            WHERE DataRelatorio BETWEEN :ini AND :fim                            GROUP BY NomeEmpresa ORDER BY IdEmpresaRelatorio, CodigoRelatorio", "ini={$post['HInicioRelatorio']}&fim={$post['HFimRelatorio']}");        ?>        <table border="1" style="width: 100%;" class="table_print">            <thead>            <th colspan="2" rowspan="4">                <img src="images/logo_med.png" width="180"/>            </th>            <th colspan="6" rowspan="4">                Relatório de Atendimento - HelpDesk <br/>                Período de : <?= date("d/m/Y", strtotime($post['HInicioRelatorio'])); ?> a <?= date("d/m/Y", strtotime($post['HFimRelatorio'])); ?>  <br/>                Seleção de Clientes : TODOS <br/>            </th>        </thead>        <?php        foreach ($Read->getResult() as $v):            extract($v);            ?>            <tr>                <td colspan="2" rowspan="1">Razão Social :</td>                <th colspan="6" rowspan="1"><?= $NomeEmpresa; ?></th>            </tr>            <tr>                <th colspan="1">Nro Chamado</th>                <th colspan="1">Consultor Técnico</th>                <th colspan="2">Descrição do Serviço</th>                <th colspan="1">Hora Inicio</th>                <th colspan="1">Hora Final</th>                <th colspan="1">Horas Aplicadas</th>                <th colspan="1">Data Atendimento</th>            </tr>            <?php            $Read->FullRead("SELECT *                            FROM tb_relatorios                             WHERE DataRelatorio BETWEEN :ini AND :fim AND IdEmpresaRelatorio = :id                            ORDER BY DataRelatorio ASC", "ini={$post['HInicioRelatorio']}&fim={$post['HFimRelatorio']}&id={$IdEmpresa}");            $r = $Read->getRowCount();            foreach ($Read->getResult() as $x)://                                extract($v);                ?>                <tr>                    <td colspan="1"><?= $x['CodigoRelatorio']; ?></td>                    <td colspan="1"><?= $x['ConsultorRelatorio']; ?></td>                    <td colspan="2"><?= $x['DescServicoRelatorio']; ?></td>                    <td colspan="1"><?= $x['HInicioRelatorio']; ?></td>                    <td colspan="1"><?= $x['HFimRelatorio']; ?></td>                    <td colspan="1"><?= $x['HTotalRelatorio']; ?></td>                    <td colspan="1"><?= date('d/m/Y', strtotime($x['DataRelatorio'])); ?></td>                </tr>                <?php            endforeach;            ?>            <tr>                <td colspan="8" rowspan="1"><br></td>            </tr>            <tr>                <td colspan="4" rowspan="1"></td>                <td colspan="4" rowspan="1">Total de atendimentos : <?= $r; ?></td>            </tr>            <tr>                <td colspan="8" rowspan="1"><br></td>            </tr>            <?php        endforeach;        ?>        </table>        <?php    else:        $Read->FullRead("SELECT * FROM tb_empresas WHERE IdEmpresa = :id", "id={$post['IdEmpresaRelatorio']}");        ?>        <table border="1" style="width: 100%;" class="table_print">            <thead>            <th colspan="2" rowspan="4">                <img src="images/logo_med.png" width="180"/>            </th>            <th colspan="6" rowspan="4">                Relatório de Atendimento - HelpDesk <br/>                Período de : <?= date("d/m/Y", strtotime($post['HInicioRelatorio'])); ?> a <?= date("d/m/Y", strtotime($post['HFimRelatorio'])); ?>  <br/>                Seleção de Clientes : <?= $Read->getResult()[0]['NomeEmpresa']; ?> <br/>            </th>        </thead>        <?php        foreach ($Read->getResult() as $v):            extract($v);            ?>            <tr>                <td colspan="2" rowspan="1">Razão Social :</td>                <th colspan="6" rowspan="1"><?= $NomeEmpresa; ?></th>            </tr>            <tr>                <th colspan="1">Nro Chamado</th>                <th colspan="1">Consultor Técnico</th>                <th colspan="2">Descrição do Serviço</th>                <th colspan="1">Hora Inicio</th>                <th colspan="1">Hora Final</th>                <th colspan="1">Horas Aplicadas</th>                <th colspan="1">Data Atendimento</th>            </tr>            <?php            $Read->FullRead("                            SELECT * FROM tb_relatorios                             WHERE DataRelatorio BETWEEN :ini AND :fim AND IdEmpresaRelatorio = :id                            ORDER BY DataRelatorio ASC", "ini={$post['HInicioRelatorio']}&fim={$post['HFimRelatorio']}&id={$post['IdEmpresaRelatorio']}");            $r = $Read->getRowCount();            foreach ($Read->getResult() as $x):                ?>                <tr>                    <td colspan="1"><?= $x['CodigoRelatorio']; ?></td>                    <td colspan="1"><?= $x['ConsultorRelatorio']; ?></td>                    <td colspan="2"><?= $x['DescServicoRelatorio']; ?></td>                    <td colspan="1"><?= $x['HInicioRelatorio']; ?></td>                    <td colspan="1"><?= $x['HFimRelatorio']; ?></td>                    <td colspan="1"><?= $x['HTotalRelatorio']; ?></td>                    <td colspan="1"><?= date('d/m/Y', strtotime($x['DataRelatorio'])); ?></td>                </tr>                <?php            endforeach;            ?>            <tr>                <td colspan="8" rowspan="1"><br></td>            </tr>            <tr>                <td colspan="4" rowspan="1"></td>                <td colspan="4" rowspan="1">Total de atendimentos : <?= $r; ?></td>            </tr>            <tr>                <td colspan="8" rowspan="1"><br></td>            </tr>            <?php        endforeach;        ?>        </table>    <?php    endif;endif;?></body></html>